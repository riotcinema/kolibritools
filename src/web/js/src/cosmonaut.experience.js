/**
 * cosmonautexperience.com
 *
 * Website for The Cosmonaut movie.
 *
 * NOTE OF LICENSE
 * Licensed under GNU General Public License version 3.0
 *
 * Copyright (c) 2013 Tecnilógica Soluciones Avanzadas.
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the GNU Public License v3.0
 * which accompanies this distribution, and is available at
 * http://www.gnu.org/licenses/gpl.html
 *
 * Contributors:
 * Tecnilógica Soluciones Avanzadas - initial API and implementation
 *
 * @package   cosmonautexperience
 * @author    Tecnilógica soluciones avanzadas
 * @copyright Copyright (c) 2003 - 2013, Tecnilógica soluciones avanzadas, S.A. (http://tecnilogica.com/)
 * @license   http://www.gnu.org/licenses/gpl-3.0.html
 * @link      http://cosmonautexperience.com
 * 
 * 
 * cosmonaut.experience.js
 */
cosmonaut.experience=new Array();cosmonaut.experience.calculateTotalCost=function(){var n=$("#extraSelectors input:checkbox:checked").length+$("#techSelectors input:radio:checked").length;if(n>0){$(".form-modules").show();}else{$(".form-modules").hide();}var total=0;if($("#inputExtraMerchandising:checked")){total={{@VALUE_MERCHANDISING}};$("#extrasModule").removeClass("green");$("#extrasModuleValue").html("{{@VALUE_MERCHANDISING}}<span>€</span>");$("#extrasModuleConcept").html("{{@dict_tra_org_merchandising}}");}else{total=0;$("#extrasModule").addClass("green");$("#extrasModuleValue").html("{{@dict_tra_org_free}}");$("#extrasModuleConcept").html("");}switch ($('input[name=technical]:checked', '#frmOrganizeEvent').attr("id")){case "inputTechStreaming":total+=0;$("#techModule").addClass("green");$("#techModuleValue").html("{{@dict_tra_org_free}}");$("#techModuleConcept").html("{{@dict_tra_org_streaming}}");break;case "inputTechDCP":total+={{@VALUE_DCP}};$("#techModule").removeClass("green");$("#techModuleValue").html("{{@VALUE_DCP}}<span>€</span>");$("#techModuleConcept").html("{{@dict_tra_org_dcp}}");break;case "inputTechDVD":total+={{@VALUE_DVD}};$("#techModule").removeClass("green");$("#techModuleValue").html("{{@VALUE_DVD}}<span>€</span>");$("#techModuleConcept").html("{{@dict_tra_org_dvd_bluray}}");break;case "inputTech35mm":total+=0;$("#techModule").removeClass("green");$("#techModuleValue").html("???");$("#techModuleConcept").html("{{@dict_tra_org_35mm}}");break;default:total+=0;$("#techModule").addClass("green");$("#techModuleValue").html("{{@dict_tra_org_free}}");$("#techModuleConcept").html("");break;}if(total>0){$("#totalModule").removeClass("green");$("#totalModuleValue").html(total.toString()+"<span>€</span>");}else{$("#totalModule").addClass("green");$("#totalModuleValue").html("{{@dict_tra_org_free}}");}};cosmonaut.experience.closeDemandDialog=function(){cosmonaut.cleanForm("frmDemandEvent");$("#lightbox-demand").dialog("close")};cosmonaut.experience.closeDemandConfirmationDialog=function(){$("#lightbox-demand-confirm").dialog("close")};cosmonaut.experience.closeOrganizeDialog=function(){cosmonaut.cleanForm("frmOrganizeEvent");$("#lightbox-organize").dialog("close")};cosmonaut.experience.closeOrganizeConfirmationDialog=function(){$("#confOrganizeHeader").html("");$(".formModules").hide();$("#lightbox-organize-confirm").dialog("close")};cosmonaut.experience.event2row=function(e){var t=$(document.createElement("tr"));var n=$(document.createElement("td")).appendTo($(t));var r=$(document.createElement("td")).appendTo($(t));var i=$(document.createElement("td")).appendTo($(t));var s=$(document.createElement("td")).appendTo($(t));var o=$(document.createElement("span")).appendTo($(n));var u=$(document.createElement("span")).appendTo($(r));var a=$(document.createElement("span")).appendTo($(i));var f=$(document.createElement("a")).addClass("ticket").appendTo($(s));$(t).appendTo($("#events_table"));if(e.link==null){$(f).addClass("disable");$(f).html("{{@dict_eve_no_tickets}}")}else{$(f).html("{{@dict_eve_buy}}");$(f).attr("href",e.link)}if(e.day!=null){$(o).html(e.day)}if(e.address!=null){$(u).html(e.address)}if(e.city!=null){$(a).html(e.city)}};cosmonaut.experience.fillEventsTable=function(e){var t=(new Date).getDate();$.each(e.rows,function(e,n){if((n.type=="_PROJECTION_"||n.type=="_TUGG_")&&t<=Date.parse(n.day)){cosmonaut.experience.event2row(n)}})};cosmonaut.experience.getCartoDBData=function(){var e=cosmonaut.data.cartodb.account;var t=cosmonaut.data.cartodb.api_key;var n="SELECT * FROM elcosmonauta ORDER BY day";$.getJSON("http://"+e+".cartodb.com/api/v2/sql/?q="+n,function(e){}).success(function(e){cosmonaut.map.fillProjectionsData(e);cosmonaut.experience.fillEventsTable(e)}).error(function(){}).complete(function(){})};cosmonaut.experience.openDemandDialog=function(){$("#lightbox-demand").css("display","block");$("#lightbox-demand").dialog("open");$("#lightbox-demand").dialog("moveToTop")};cosmonaut.experience.openDemandConfirmationDialog=function(){$("#lightbox-demand-confirm").css("display","block");$("#lightbox-demand-confirm").dialog("open");$("#lightbox-demand-confirm").dialog("moveToTop")};cosmonaut.experience.openOrganizeDialog=function(){$("#lightbox-organize").css("display","block");$("#lightbox-organize").dialog("open");$("#lightbox-organize").dialog("moveToTop")};cosmonaut.experience.openOrganizeConfirmationDialog=function(){$("#lightbox-organize-confirm").css("display","block");$("#lightbox-organize-confirm").dialog("open");$("#lightbox-organize-confirm").dialog("moveToTop")};cosmonaut.experience.submitDemandEventForm=function(){var valid=cosmonaut.experience.validateDemandForm();if(valid){var inp_city=$("#inputCity").val();var inp_zip_code=$("#inputZipCode").val();$.ajax({url:"{{@BASE_URL}}/show/demand",cache:false,type:"POST",dataType:"json",data:{alert_me:$("#inputAlert").is(':checked'),city:$("#inputCity").val(),email:$("#inputEmail").val(),help:$("#inputYes").is(':checked'),type_experience:$("#inputTypeExperience").is(':checked'),type_normal:$("#inputTypeNormal").is(':checked'),type_screen:$("#inputTypeScreen").is(':checked'),zip_code:$("#inputZipCode").val()},beforeSend: function(){},complete:function(){},success:function(json_response){var insertion=cosmonaut.map.insertDemand(inp_city,inp_zip_code);if(insertion==true){$("#confDemandHeader").html("{{@dict_tra_dem_conf_demand_head}}");$("#confOrganizeP1").html("{{@dict_tra_dem_conf_demand_p1}}");$("#confOrganizeP2").html("{{@dict_tra_dem_conf_demand_p2}}");if(json_response.success==true){cosmonaut.experience.closeDemandDialog();cosmonaut.experience.openDemandConfirmationDialog();}}else{cosmonaut.experience.openDemandConfirmationDialog();$("#confDemandHeader").html("{{@dict_tra_dem_error_locating_head }}");$("#confOrganizeP1").html("{{ @dict_tra_dem_error_locating_body }}");}}});}else{$(".validity-tooltip").each( function(index,item){$(item).offset({top:$(item).position().top-40,left:$(item).position().left-30});});}};cosmonaut.experience.submitOrganizeEventForm=function(){var valid=cosmonaut.experience.validateOrganizeForm();if(valid){var org_name=$("#inputOrgName").val();var org_address=$("#inputOrgAddress").val();$.ajax({url:"{{@BASE_URL}}/show/organize",cache:false,type:"POST",dataType:"json",data:{where_pro:$("#inputWherePro").is(':checked'),where_amateur:$("#inputWhereAmateur").is(':checked'),where_descriptor:$("#inputWhereDescriptor").val(),where_people:$("#inputWherePeople").val(),extras_profit:$("#inputExtraProfit").is(':checked'),extras_additional:$("#inputExtraAdditional").is(':checked'),extras_snacks:$("#inputExtraSnacks").is(':checked'),extras_party:$("#inputExtraParty").is(':checked'),extras_q_and_a:$("#inputExtraQandA").is(':checked'),extras_merchandising:$("#inputExtraMerchandising").is(':checked'),tech_streaming:$("#inputTechStreaming").is(':checked'),tech_dcp:$("#inputTechDCP").is(':checked'),tech_dvd:$("#inputTechDVD").is(':checked'),tech_35mm:$("#inputTech35mm").is(':checked'),vo:$("#inputVO").is(':checked'),vo_spanish:$("#inputVOSpanish").is(':checked'),vo_english:$("#inputVOEnglish").is(':checked'),complete_name:$("#inputOrgName").val(),id:$("#inputOrgID").val(),address:$("#inputOrgAddress").val(),date:$("#inputOrgDate").val(),phone:$("#inputOrgPhone").val(),email:$("#inputOrgEmail").val()},beforeSend: function(){},complete:function(){},success:function(json_response){if (json_response.success==true){cosmonaut.experience.closeOrganizeDialog();cosmonaut.experience.openOrganizeConfirmationDialog();$("#confOrganizeHeader").html("{{@dict_tra_org_conf_organize_head}}"+org_name+"!");$("#confOrganizeP").append(" "+org_address+"!");}}});}else{$(".validity-tooltip").each(function(index, item){$(item).offset({ top: $(item).position().top-80, left: $(item).position().left-30});});}};cosmonaut.experience.validateDemandForm=function(){$.validity.setup({scrollTo:true,lang:"es"});$.validity.start();var e=$(".inputType:checkbox:checked").length>0;var t=$("#inputAccept:checked").length>0;$("#inputEmail").require("{{@dict_tra_dem_error_email}}").match("email");$("#inputCity").require("{{@dict_tra_dem_error_generic_demand}}");$("#inputZipCode").require("{{@dict_tra_dem_error_generic_demand}}");$("#inputAccept").assert(t,"{{@dict_tra_dem_error_accept}}");$("#inputTypeNormal").assert(e,"{{@dict_tra_dem_error_type}}");var n=$.validity.end();return n.valid};cosmonaut.experience.validateOrganizeForm=function(){$.validity.setup({scrollTo:true});$.validity.start();var e=$(".where:radio:checked").length>0;var t=$(".format:radio:checked").length>0;var n=$(".lang:radio:checked").length>0;$("#inputWhereDescriptor").require("{{ @dict_tra_org_error_generic_org }}");$("#inputOrgName").require("{{ @dict_tra_org_error_generic_org }}");$("#inputOrgID").require("{{ @dict_tra_org_error_generic_org }}");$("#inputOrgDate").require("{{ @dict_tra_org_error_generic_org }}");$("#inputOrgEmail").require("{{ @dict_tra_org_error_email }}").match("email");$("#inputWherePro").assert(e,"{{ @dict_tra_org_error_generic_org }}");$("#inputTechStreaming").assert(t,"{{ @dict_tra_org_error_generic_org }}");$("#inputVO").assert(n,"{{ @dict_tra_org_error_generic_org }}");var r=$.validity.end();return r.valid};$("#cancelDemandEventForm").click(function(e){e.preventDefault();cosmonaut.experience.closeDemandDialog()});$("#cancelOrganizeEventForm").click(function(e){e.preventDefault();cosmonaut.experience.closeOrganizeDialog()});$("#cerrar-lightbox-demand").click(function(e){e.preventDefault();cosmonaut.experience.closeDemandDialog()});$("#cerrar-lightbox-organize").click(function(e){e.preventDefault();cosmonaut.experience.closeOrganizeDialog()});$("#closeDemandEventConfirmation").click(function(e){e.preventDefault();cosmonaut.experience.closeDemandConfirmationDialog()});$("#closeOrganizeEventConfirmation").click(function(e){e.preventDefault();cosmonaut.experience.closeOrganizeConfirmationDialog()});$("#downloadGuide").click(function(e){e.preventDefault();$(location).attr("href","{{@lang_url_screening_guide}}")});$("#enlace-lightbox-demand").click(function(e){e.preventDefault();cosmonaut.experience.openDemandDialog()});$("#enlace-lightbox-organize").click(function(e){e.preventDefault();cosmonaut.experience.openOrganizeDialog()});$("#ftLinkFind").click(function(e){e.preventDefault();cosmonaut.jumpTo("sectionMap")});$("#ftLinkDemand").click(function(e){e.preventDefault();cosmonaut.experience.openDemandDialog()});$("#ftLinkOrganize").click(function(e){e.preventDefault();cosmonaut.experience.openOrganizeDialog()});$("#frmOrganizeEvent :checkbox").change(function(e){cosmonaut.experience.calculateTotalCost()});$("#frmOrganizeEvent :radio").change(function(e){cosmonaut.experience.calculateTotalCost()});$("#submitDemandEventForm").click(function(e){e.preventDefault();cosmonaut.experience.submitDemandEventForm()});$("#submitOrganizeEventForm").click(function(e){e.preventDefault();cosmonaut.experience.submitOrganizeEventForm()});$("#lightbox-demand").dialog({autoOpen:false,close:function(){cosmonaut.experience.closeDemandDialog()},modal:true,option:"closeOnEscape",show:"fade",width:"900px"});$("#lightbox-demand-confirm").dialog({autoOpen:false,modal:true,option:"closeOnEscape",show:"fade",width:"454px"});$("#lightbox-organize").dialog({autoOpen:false,close:function(){cosmonaut.experience.closeOrganizeDialog()},modal:true,option:"closeOnEscape",show:"fade",width:"900px"});$("#lightbox-organize-confirm").dialog({autoOpen:false,modal:true,option:"closeOnEscape",show:"fade",width:"454px"});$("#inputExtraProfit").change(function(){if(this.checked){$("#inputExtraAdditional").prop("checked",false);$("#inputExtraSnacks").prop("checked",false);$("#inputExtraParty").prop("checked",false);$("#inputExtraQandA").prop("checked",false);$("#inputExtraMerchandising").prop("checked",false);$("#inputExtraAdditional").attr("disabled",true);$("#inputExtraSnacks").attr("disabled",true);$("#inputExtraParty").attr("disabled",true);$("#inputExtraQandA").attr("disabled",true);$("#inputExtraMerchandising").attr("disabled",true)}else{$("#inputExtraAdditional").removeAttr("disabled");$("#inputExtraSnacks").removeAttr("disabled");$("#inputExtraParty").removeAttr("disabled");$("#inputExtraQandA").removeAttr("disabled");$("#inputExtraMerchandising").removeAttr("disabled")}});$(":checkbox").change(function(){if(this.checked){$("label[for='"+$(this).attr("name")+"']").css("color","#333")}else{$("label[for='"+$(this).attr("name")+"']").css("color","#666")}});$(":radio").change(function(){if(this.checked){$("label[for='"+$(this).attr("name")+"']").css("color","#333")}else{$("label[for='"+$(this).attr("name")+"']").css("color","#666")}});$(document).ready(function(){$(".form-modules").hide();cosmonaut.loadRecentPosts();$(".ui-dialog-titlebar-close").css("display","none");cosmonaut.experience.getCartoDBData();var e=$("#jump_to").val();if(e!=undefined){cosmonaut.jumpTo(e)}var t=$("#auto_open").val();if(t!=undefined){$("#"+t).dialog("open")}});